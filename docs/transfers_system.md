# Система внутренних переводов и Финансы (Banking)

Этот документ описывает архитектуру, функциональные возможности и этапы внедрения системы внутренних платежей в экосистеме Abundance Effect.

## 1. Обзор системы
Система предназначена для обеспечения мгновенных и безопасных взаиморасчетов между пользователями внутри платформы. Она включает в себя как простые P2P-переводы, так и расширенные инструменты для бизнеса (прием платежей, автоматизация, кассы).

## 2. Основные функции (P2P Переводы)
Инструменты для обычных пользователей:
*   **Перевод по идентификатору**: Отправка средств по User ID, логину, номеру телефона или QR-коду.
*   **Типы переводов**:
    *   **Прямой перевод**: Мгновенное списание и зачисление.
    *   **Перевод с протекцией**: Средства блокируются до подтверждения получения товара/услуги (Escrow).
    *   **Чеки (Gift Links)**: Создание ссылки на определенную сумму, которую может обналичить любой пользователь (или конкретный адресат).
*   **История операций**: Детализированный лог всех входящих и исходящих транзакций с фильтрацией по типам.

## 3. Возможности для бизнеса
Инструменты для селлеров, наставников и проектов:

### Выставление счетов (Invoicing)
*   **Одноразовые инвойсы**: Счет на фиксированную сумму для конкретного пользователя.
*   **Многоразовые счета (Payment Links)**: Публичная ссылка для оплаты товара/услуги неограниченным количеством пользователей.
*   **Динамические счета**: Возможность пользователю самому вводить сумму (например, для донатов или оплаты по весу/количеству).

### Автоматизация и управление
*   **Кассы (Merchant Accounts)**: Возможность разделять личные средства и средства от бизнес-деятельности.
*   **Webhook-уведомления**: Автоматическое уведомление сторонних сервисов об успешной оплате.
*   **Рекуррентные платежи**: Подписки на услуги (автосписание Liquid $ раз в месяц).
*   **Отчетность**: Выгрузка реестров операций в PDF/CSV для бухгалтерии.

## 4. Внешние интеграции и технологии

### Банковские системы
*   **СБП (Система Быстрых Платежей)**: Интеграция через API банков-партнеров или агрегаторов (например, Raiffeisen, Tinkoff) для ввода/вывода средств.
*   **Open Banking API**: Синхронизация истории операций с реальными банковскими счетами (где доступно).

### Криптовалюты
*   **TonConnect**: Основной шлюз для работы с экосистемой TON.
*   **Платежные шлюзы (Plisio, NOWPayments)**: Прием BTC, ETH, USDT и других валют с автоматической конвертацией в Liquid $.
*   **Смарт-контракты**: Использование децентрализованных протоколов для эскроу-сделок.

### Telegram Wallet
*   **Direct Integration**: Бесшовная связь с внутренним кошельком Telegram через Bot API.
*   **Уведомления**: Отправка квитанций и уведомлений о транзакциях напрямую в чат-бота.

## 5. Что внедряем сейчас (Дорожная карта)

Мы двигаемся от простого к сложному, обеспечивая стабильность на каждом этапе.

### Фаза 1: Базовая P2P инфраструктура (Текущий этап)
1.  **DB Schema**: Таблица `transactions` для учета всех перемещений Liquid $.
2.  **API Переводов**: Server Action для безопасного перевода между балансами пользователей.
3.  **UI**: Модальное окно "Отправить" с поиском пользователя и вводом суммы.
4.  **История**: Список последних транзакций в Wallet.

### Фаза 2: Счета и Чеки
1.  **Создание инвойса**: Простой UI для формирования счета.
2.  **Оплата инвойса**: Уведомление получателю и кнопка "Оплатить" в один клик.
3.  **Чеки**: Генерация уникальных кодов/ссылок на получение Liquid $.

### Фаза 3: Бизнес-инструменты (Merchant API)
1.  **Кассы**: Возможность создания "Мерчанта" в профиле.
2.  **Публичные платежные страницы**: `/pay/[merchant_id]`.
3.  **История для бизнеса**: Расширенная аналитика доходов.

### Фаза 4: Автоматизация и Внешние шлюзы
1.  **Webhook системы**.
2.  **Интеграция СБП (QR-коды)**.
3.  **Автоматизация выплат**.

## 6. Безопасность
*   **2FA**: Подтверждение крупных переводов через Telegram/Email.
*   **Лимиты**: Настраиваемые суточные и разовые лимиты на операции.
*   **Антифрод**: Базовая проверка на подозрительную активность (частые мелкие переводы, смена IP).
