# Настройка Автоматической Авторизации

## Что было реализовано

### 1. Главная страница (`app/page.tsx`)
- **Для неавторизованных**: Показывает кнопку "Войти" → переход на `/login`
- **Для авторизованных**: Показывает данные пользователя (баланс, уровень, профиль)

### 2. Автоматический вход через Telegram
Telegram использует **особый подход** (не OAuth):
- Когда пользователь открывает приложение из Telegram-бота, `UserContext` автоматически обнаруживает Telegram WebApp данные
- Вызывает API `/api/auth/telegram-user` для создания/поиска пользователя
- Пользователь автоматически входит в систему

**На странице `/login`:**
- Кнопка "Continue with Telegram" проверяет, открыто ли приложение в Telegram
- Если **ДА** → редирект на главную (авторизация произойдет автоматически)
- Если **НЕТ** → показывает сообщение, что Telegram вход доступен только из бота

### 3. Обычный вход через Google
На странице `/login` доступна кнопка "Sign in with Google"

## Необходимые шаги

### Шаг 1: Добавьте SERVICE_ROLE_KEY
В файл `.env.local` добавьте:
```
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

**Где взять:**
1. Откройте [Supabase Dashboard](https://supabase.com/dashboard)
2. Выберите ваш проект
3. Settings → API → service_role key (secret)
4. Скопируйте и вставьте в `.env.local`

⚠️ **ВАЖНО**: Этот ключ должен быть ТОЛЬКО на сервере, никогда не отправляйте его на клиент!

### Шаг 2: Выполните миграцию БД
Если еще не выполнили, запустите SQL из файла:
`supabase/migrations/0000_init_users.sql`

В Supabase Dashboard → SQL Editor → вставьте и выполните.

### Шаг 3: Настройте Telegram Bot
Для автоматического входа через Telegram нужно:
1. Создать Telegram бота через [@BotFather](https://t.me/botfather)
2. Настроить Web App URL в боте (URL вашего приложения)
3. Пользователи будут открывать приложение через кнопку в боте

### Шаг 4: Настройте Google OAuth (опционально)
В Supabase Dashboard:
1. Authentication → Providers → Google
2. Включите Google Provider
3. Добавьте Client ID и Client Secret из Google Cloud Console

## Как это работает

### Сценарий 1: Переход из Telegram
1. Пользователь нажимает кнопку в Telegram-боте
2. Открывается ваше приложение
3. `UserContext` обнаруживает Telegram WebApp данные
4. Автоматически создается/находится пользователь
5. Пользователь видит свой профиль на главной странице

### Сценарий 2: Обычный вход
1. Пользователь открывает приложение напрямую
2. Видит главную страницу с кнопкой "Войти"
3. Нажимает "Войти" → переход на `/login`
4. Выбирает "Sign in with Google"
5. После авторизации возвращается на главную страницу с данными

## Тестирование

### Локально (без Telegram)
1. Запустите `npm run dev`
2. Откройте `http://localhost:3000`
3. Нажмите "Войти"
4. Войдите через Google
5. Проверьте, что видите свои данные

### С Telegram (требует деплоя)
1. Задеплойте на Vercel
2. Настройте Telegram бота с URL вашего приложения
3. Откройте бота в Telegram
4. Нажмите кнопку Web App
5. Должны автоматически войти

## Следующие шаги
- Добавить кнопку "Выйти"
- Защитить другие страницы (редирект на /login если не авторизован)
- Реализовать Onboarding Slider
