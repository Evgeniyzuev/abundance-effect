# –û—Ç–ª–∞–¥–∫–∞ Telegram Mini App –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üîç –ü—Ä–æ–±–ª–µ–º–∞:
- –í Telegram Mini App –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "Authenticating..." –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç

## üìã –®–∞–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –≤ Telegram

**–î–ª—è Android:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Advanced ‚Üí Experimental Settings
3. –í–∫–ª—é—á–∏—Ç–µ "Enable WebView Inspection"
4. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –∏ Mini App
5. –í Chrome –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –æ—Ç–∫—Ä–æ–π—Ç–µ `chrome://inspect`
6. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –Ω–∞–∂–º–∏—Ç–µ "Inspect"

**–î–ª—è iOS:**
1. –ù–∞ iPhone: Settings ‚Üí Safari ‚Üí Advanced ‚Üí Web Inspector (–≤–∫–ª—é—á–∏—Ç—å)
2. –ù–∞ Mac: Safari ‚Üí Develop ‚Üí [–í–∞—à iPhone] ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ WebView

**–î–ª—è Desktop (Telegram Desktop):**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram Desktop
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –∏ Mini App
3. –ù–∞–∂–º–∏—Ç–µ `Ctrl+Shift+I` (Windows/Linux) –∏–ª–∏ `Cmd+Option+I` (Mac)

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤:

```
[UserContext] Initializing...
[UserContext] Telegram user detected: {id: ..., first_name: ...}
[UserContext] Calling /api/auth/telegram-user...
[UserContext] API response: {success: true, password: "..."}
[UserContext] Signing in to Supabase...
[UserContext] Successfully signed in! {...}
[UserContext] Checking session...
[UserContext] Current session: {...}
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–¥–µ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å

#### –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "No Telegram user in initDataUnsafe":
**–ü—Ä–æ–±–ª–µ–º–∞**: Telegram WebApp –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–†–µ—à–µ–Ω–∏–µ**: 
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ BotFather
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Menu Button –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –≤–∞—à URL
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ (`/start`)

#### –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "API did not return success/password":
**–ü—Ä–æ–±–ª–µ–º–∞**: API endpoint –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –≤ DevTools
2. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/auth/telegram-user`
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Response:
   - –ï—Å–ª–∏ 500 –æ—à–∏–±–∫–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
   - –ï—Å–ª–∏ 400 –æ—à–∏–±–∫–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

#### –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "Error signing in with Telegram":
**–ü—Ä–æ–±–ª–µ–º–∞**: Supabase –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `SUPABASE_SERVICE_ROLE_KEY` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.env.local`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SQL –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (—Ç–∞–±–ª–∏—Ü–∞ `users` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase Dashboard

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env.local` –µ—Å—Ç—å:
```
NEXT_PUBLIC_SUPABASE_URL=https://–≤–∞—à-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=–≤–∞—à_anon_key
SUPABASE_SERVICE_ROLE_KEY=–≤–∞—à_service_role_key
TELEGRAM_BOT_TOKEN=–≤–∞—à_bot_token
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é

–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
SELECT * FROM public.users LIMIT 1;
```

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "relation does not exist" ‚Üí –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ**: –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞ `supabase/migrations/0000_init_users.sql`

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API endpoint

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ DevTools ‚Üí Network tab:
1. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/auth/telegram-user`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Request Payload
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Response

**–û–∂–∏–¥–∞–µ–º—ã–π Response:**
```json
{
  "success": true,
  "user": {...},
  "auth_user_id": "...",
  "password": "..."
}
```

### 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Auth

–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí Authentication ‚Üí Users

–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å email: `telegram_–í–ê–®–ï_ID@abundance-effect.app`

---

## üõ†Ô∏è –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev server
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
npm run dev
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞
–í Telegram Mini App:
- –ó–∞–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –û—Ç–∫—Ä–æ–π—Ç–µ —Å–Ω–æ–≤–∞

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ù–∞–∂–º–∏—Ç–µ "Open App"

---

## üìù –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å** –≤ Telegram Mini App
2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ –ª–æ–≥–∏** –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab** - –Ω–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫–∏
4. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª–æ–≥–∏** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç —Ç–æ—á–Ω–æ –≥–¥–µ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å!
