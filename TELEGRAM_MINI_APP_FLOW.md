# Telegram Mini App - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ Telegram Mini App –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **—Å—Ä–∞–∑—É** –≤–∏–¥–∏—Ç —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å, –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤.

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ –≤ Telegram
- –ù–∞–∂–∏–º–∞–µ—Ç `/start`
- –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "Open App" (–∏–ª–∏ Menu Button)

### 2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ Telegram
- `UserContext` –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç Telegram WebApp –¥–∞–Ω–Ω—ã–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `/api/auth/telegram-user`
- –°–æ–∑–¥–∞–µ—Ç/–Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç —á–µ—Ä–µ–∑ Supabase

### 3. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- **–ï—Å–ª–∏ –≤ Telegram Mini App**: 
  - –≠–∫—Ä–∞–Ω "Authenticating..." —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
  - –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
  - –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí —Å—Ä–∞–∑—É –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
- **–ï—Å–ª–∏ –Ω–∞ –æ–±—ã—á–Ω–æ–º —Å–∞–π—Ç–µ**:
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
  - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`

---

## üéØ –ü–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö:

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram Mini App
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ ‚Üí "Open App"
2. –í–∏–¥–∏—Ç "Authenticating..." (1-2 —Å–µ–∫—É–Ω–¥—ã)
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
4. –°—Ä–∞–∑—É –≤–∏–¥–∏—Ç —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram Mini App
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ ‚Üí "Open App"
2. –í–∏–¥–∏—Ç "Authenticating..." (~0.5 —Å–µ–∫—É–Ω–¥—ã)
3. –ù–∞—Ö–æ–¥–∏—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
4. –°—Ä–∞–∑—É –≤–∏–¥–∏—Ç —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –≤–µ–±-—Å–∞–π—Ç
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç –Ω–∞–ø—Ä—è–º—É—é
2. –í–∏–¥–∏—Ç –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
3. –í—ã–±–∏—Ä–∞–µ—Ç —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞ (Google/Telegram Widget)
4. –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí –ø—Ä–æ—Ñ–∏–ª—å ‚úÖ

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`app/page.tsx`):
```tsx
// –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram Mini App
const [isTelegramMiniApp, setIsTelegramMiniApp] = useState(false);

useEffect(() => {
  if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
    setIsTelegramMiniApp(true);
  }
}, []);

// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –¥–ª—è Telegram Mini App
if (isLoading || (isTelegramMiniApp && !user)) {
  return <div>Authenticating...</div>;
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏" —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Å–∞–π—Ç–∞
if (!user) {
  return <Link href="/login">–í–æ–π—Ç–∏</Link>;
}
```

### UserContext:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç Telegram WebApp
- –í—ã–∑—ã–≤–∞–µ—Ç API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç —á–µ—Ä–µ–∑ Supabase
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `user`

---

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. **–ù–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç –ø—Ä–æ—Ñ–∏–ª—å
2. **–ë—ã—Å—Ç—Ä–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - API —Å–æ–∑–¥–∞–µ—Ç/–Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ ~500ms
3. **–ü–ª–∞–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –∞–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
4. **–£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - —Ä–∞–∑–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è Telegram –∏ –≤–µ–±-—Å–∞–π—Ç–∞

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### –í Telegram:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞: `https://t.me/AbundanceEffectBot`
2. –ù–∞–∂–º–∏—Ç–µ "Open App"
3. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
   - –≠–∫—Ä–∞–Ω "Authenticating..." (1-2 —Å–µ–∫)
   - –°—Ä–∞–∑—É –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ù–ï–¢ –∫–Ω–æ–ø–∫–∏ "–í–æ–π—Ç–∏"

### –ù–∞ —Å–∞–π—Ç–µ:
1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000`
2. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
   - –ö–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏"
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
   - –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –≤—Ö–æ–¥–∞

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram Mini App
2. ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏"
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
4. [ ] –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
5. [ ] –î–æ–±–∞–≤—å—Ç–µ retry –ª–æ–≥–∏–∫—É (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å)
